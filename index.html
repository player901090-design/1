<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ForGifts - NFT –ü–æ–¥–∞—Ä–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #ffffff;
        }

        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 20px rgba(0, 114, 255, 0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.5;
        }

        .emoji-header {
            font-size: 48px;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .gift-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 30px;
            border: 2px solid rgba(0, 198, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 114, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 450px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .gift-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 30px 30px;
            opacity: 0.5;
            animation: sparkle 20s linear infinite;
        }

        @keyframes sparkle {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .nft-image {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 16px;
            overflow: hidden;
            border: 3px solid rgba(0, 198, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .nft-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .nft-image.loaded img {
            display: block;
        }

        .nft-placeholder {
            font-size: 48px;
            opacity: 0.5;
        }

        .nft-info {
            position: relative;
            z-index: 1;
        }

        .nft-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #00c6ff;
        }

        .nft-id {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .nft-description {
            font-size: 14px;
            opacity: 0.7;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .claim-button {
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 25px rgba(0, 114, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            min-width: 200px;
            opacity: 0.7;
            pointer-events: none;
        }

        .claim-button.active {
            opacity: 1;
            pointer-events: all;
        }

        .claim-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 114, 255, 0.6);
        }

        .claim-button:active {
            transform: translateY(0);
        }

        .emoji-button {
            font-size: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #00c6ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .footer {
            margin-top: 30px;
            font-size: 14px;
            opacity: 0.7;
            line-height: 1.5;
        }

        .emoji-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            font-size: 20px;
            margin: 20px 0;
            opacity: 0.8;
        }

        .badge {
            display: inline-block;
            background: rgba(0, 198, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            border: 1px solid rgba(0, 198, 255, 0.3);
        }

        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 480px) {
            .gift-card {
                padding: 20px;
                min-height: 400px;
            }
            
            .nft-image {
                width: 180px;
                height: 180px;
            }
            
            .nft-title {
                font-size: 20px;
            }
            
            .claim-button {
                padding: 14px 30px;
                font-size: 16px;
                min-width: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="emoji-header">üéÅ‚ú®</div>
            <h1>NFT –ü–æ–¥–∞—Ä–æ–∫</h1>
            <p>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –∞–∫—Ç–∏–≤ –∂–¥–µ—Ç –≤–∞—Å</p>
            <div class="badge">Limited Edition</div>
        </div>

        <div class="gift-card">
            <div class="nft-image" id="nftImageContainer">
                <div class="nft-placeholder" id="nftPlaceholder">üéÅ</div>
                <img id="nftImage" alt="NFT Image">
            </div>
            
            <div class="nft-info">
                <div class="nft-title" id="nftName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="nft-id" id="nftId">#---</div>
                <div class="nft-description" id="nftDescription">–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ NFT...</div>
                
                <div class="error-message" id="errorMessage">
                    –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ NFT. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
                </div>
                
                <button class="claim-button" id="claimButton">
                    <span class="emoji-button">‚è≥</span>
                    <span id="buttonText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </button>
            </div>
            
            <div class="emoji-row">
                <span>üíé</span>
                <span>üîµ</span>
                <span>‚ú®</span>
                <span>üöÄ</span>
            </div>
        </div>

        <div class="footer">
            <p>ForGifts ‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π NFT ‚Ä¢ 2024</p>
            <p>–û–¥–∏–Ω –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.setHeaderColor('#1a2980');
        tg.setBackgroundColor('#1a2980');

        // NFT –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const DEFAULT_NFT = {
            name: "Santa Hat",
            id: "36411",
            description: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Ä–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∞—è —à–∞–ø–∫–∞ NFT",
            image: "https://raw.githubusercontent.com/ariutta/svg-pie-chart/master/images/santa-hat.png"
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è ID NFT –∏–∑ —Å—Å—ã–ª–∫–∏
        function extractNFTIdFromURL(url) {
            try {
                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å—Å—ã–ª–æ–∫
                if (url.includes('SantaHat-')) {
                    const match = url.match(/SantaHat-(\d+)/);
                    return match ? match[1] : DEFAULT_NFT.id;
                }
                return DEFAULT_NFT.id;
            } catch (e) {
                return DEFAULT_NFT.id;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö NFT —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã–µ API
        async function fetchNFTData(nftId) {
            const nftData = { ...DEFAULT_NFT, id: nftId };
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
            const sources = [
                // 1. Opensea API (–µ—Å–ª–∏ –µ—Å—Ç—å)
                async () => {
                    try {
                        const response = await fetch(`https://api.opensea.io/api/v1/asset/0x.../${nftId}/`, {
                            headers: {
                                'Accept': 'application/json',
                                'X-API-KEY': ''
                            }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            return {
                                name: data.name || nftData.name,
                                description: data.description || nftData.description,
                                image: data.image_url || nftData.image,
                                external_url: data.external_link
                            };
                        }
                    } catch (e) {}
                    return null;
                },
                
                // 2. Rarible API
                async () => {
                    try {
                        const response = await fetch(`https://api.rarible.org/v0.1/items/byId?itemId=ETHEREUM:0x...:${nftId}`);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.meta) {
                                return {
                                    name: data.meta.name || nftData.name,
                                    description: data.meta.description || nftData.description,
                                    image: data.meta.image?.url?.ORIGINAL || nftData.image
                                };
                            }
                        }
                    } catch (e) {}
                    return null;
                },
                
                // 3. Generic NFT API
                async () => {
                    try {
                        // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ IPFS –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                        const ipfsHash = "Qm..."; // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π IPFS hash
                        const response = await fetch(`https://ipfs.io/ipfs/${ipfsHash}/${nftId}.json`);
                        if (response.ok) {
                            const data = await response.json();
                            return {
                                name: data.name || nftData.name,
                                description: data.description || nftData.description,
                                image: data.image || nftData.image
                            };
                        }
                    } catch (e) {}
                    return null;
                },
                
                // 4. Mock API –¥–ª—è —Ç–µ—Å—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
                async () => {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ Santa Hat –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                    const santaImages = [
                        "https://cdn-icons-png.flaticon.com/512/2582/2582635.png",
                        "https://cdn-icons-png.flaticon.com/512/2582/2582667.png",
                        "https://cdn-icons-png.flaticon.com/512/2582/2582674.png",
                        "https://raw.githubusercontent.com/ariutta/svg-pie-chart/master/images/santa-hat.png",
                        "https://www.pngarts.com/files/3/Santa-Hat-PNG-Image.png"
                    ];
                    
                    const randomImage = santaImages[Math.floor(Math.random() * santaImages.length)];
                    
                    return {
                        name: `Santa Hat #${nftId}`,
                        description: `–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Ä–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∞—è —à–∞–ø–∫–∞ NFT #${nftId}. –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç.`,
                        image: randomImage,
                        attributes: [
                            { trait_type: "Holiday", value: "Christmas" },
                            { trait_type: "Rarity", value: "Rare" },
                            { trait_type: "Edition", value: nftId }
                        ]
                    };
                }
            ];
            
            // –ü—Ä–æ–±—É–µ–º –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏
            for (const source of sources) {
                try {
                    const data = await source();
                    if (data) {
                        return { ...nftData, ...data };
                    }
                } catch (e) {
                    console.log("Source failed:", e);
                }
            }
            
            return nftData;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadImage(url, callback) {
            const img = new Image();
            img.onload = () => callback(true, url);
            img.onerror = () => callback(false, url);
            img.src = url;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function initializeNFT() {
            const nftImageContainer = document.getElementById('nftImageContainer');
            const nftImage = document.getElementById('nftImage');
            const nftPlaceholder = document.getElementById('nftPlaceholder');
            const nftName = document.getElementById('nftName');
            const nftId = document.getElementById('nftId');
            const nftDescription = document.getElementById('nftDescription');
            const claimButton = document.getElementById('claimButton');
            const buttonText = document.getElementById('buttonText');
            const errorMessage = document.getElementById('errorMessage');
            
            // –ü–æ–ª—É—á–∞–µ–º NFT ID –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –∏–ª–∏ Telegram
            const urlParams = new URLSearchParams(window.location.search);
            const telegramLink = urlParams.get('link') || 'https://t.me/nft/SantaHat-36411';
            const nftIdFromLink = extractNFTIdFromURL(telegramLink);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º ID
            nftId.textContent = `#${nftIdFromLink}`;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ NFT
            try {
                buttonText.innerHTML = '<span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞ NFT...';
                
                const nftData = await fetchNFTData(nftIdFromLink);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                nftName.textContent = nftData.name;
                nftDescription.textContent = nftData.description;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                loadImage(nftData.image, (success, imageUrl) => {
                    if (success) {
                        nftImage.src = imageUrl;
                        nftImageContainer.classList.add('loaded');
                        nftPlaceholder.style.display = 'none';
                        errorMessage.style.display = 'none';
                        
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                        claimButton.classList.add('active');
                        buttonText.innerHTML = '<span class="emoji-button">üéÅ</span> –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫';
                    } else {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        nftImage.src = DEFAULT_NFT.image;
                        nftImageContainer.classList.add('loaded');
                        nftPlaceholder.style.display = 'none';
                        errorMessage.style.display = 'block';
                        
                        claimButton.classList.add('active');
                        buttonText.innerHTML = '<span class="emoji-button">üéÅ</span> –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫';
                    }
                });
                
            } catch (error) {
                console.error("Error loading NFT:", error);
                errorMessage.style.display = 'block';
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                nftName.textContent = DEFAULT_NFT.name;
                nftDescription.textContent = DEFAULT_NFT.description;
                nftImage.src = DEFAULT_NFT.image;
                nftImageContainer.classList.add('loaded');
                nftPlaceholder.style.display = 'none';
                
                claimButton.classList.add('active');
                buttonText.innerHTML = '<span class="emoji-button">üéÅ</span> –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫';
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å"
            claimButton.addEventListener('click', function() {
                if (!claimButton.classList.contains('active')) return;
                
                const button = this;
                const originalText = buttonText.innerHTML;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
                button.style.transform = 'scale(0.95)';
                buttonText.innerHTML = '<span class="emoji-button">‚è≥</span> –û–±—Ä–∞–±–æ—Ç–∫–∞...';
                button.disabled = true;
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–ª—É—á–µ–Ω–∏—è
                setTimeout(() => {
                    buttonText.innerHTML = '<span class="emoji-button">‚úÖ</span> –ü–æ–ª—É—á–µ–Ω–æ!';
                    button.style.background = 'linear-gradient(135deg, #00ff88, #0072ff)';
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–∞
                    tg.sendData(JSON.stringify({
                        action: 'claim_nft',
                        nft_id: nftIdFromLink,
                        nft_name: nftName.textContent,
                        nft_link: telegramLink,
                        timestamp: new Date().getTime()
                    }));
                    
                    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                    tg.showAlert(`üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! NFT "${nftName.textContent}" —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω!`);
                    
                }, 1500);
                
                setTimeout(() => {
                    button.style.transform = '';
                    button.disabled = false;
                    buttonText.innerHTML = originalText;
                    button.style.background = 'linear-gradient(135deg, #00c6ff, #0072ff)';
                }, 3000);
            });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        document.addEventListener('DOMContentLoaded', initializeNFT);
    </script>
</body>
</html>
